#!/bin/bash

# Production proxibase startup script using nodemon
# See https://github.com/remy/nodemon

if [ ! $PROX ]; then
  PROX='/usr/local/prox'
fi

if [ ! $PROXLOG ]; then
  PROXLOG='/var/log/prox/prox.log'
fi

# Replace the existing log, must be the first argument
if [ "$1" = "-r" ]; then
  rm $PROXLOG
  shift
fi

echo "proxlog: $PROXLOG ..."

cd $PROX
nohup nodemon -L --watch ./lib --delay 2 ./prox.js $@ >>$PROXLOG 2>&1 &

sleep 5
cat $PROXLOG
echo
