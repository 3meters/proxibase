#!/bin/bash

# Production proxibase startup script using nodemon
# See https://github.com/remy/nodemon

PROX="/usr/local/prox"
LOGDIR="/var/log/prox"
PROXLOG="$LOGDIR/prox.log"
ERRLOG="$LOGDIR/proxerr.log"
OLD="$LOGDIR/old"
DATE=`date +"%Y.%m.%d-%T"`

cp $PROXLOG "$OLD/$DATE.prox.log"
>$PROXLOG

cp $ERRLOG "$OLD/$DATE.proxerr.log"
>$ERRLOG

echo "proxerr.log: $ERRLOG"
echo "prox.log: $PROXLOG ..."

cd $PROX
nohup nodemon -L --watch ./lib --delay 2 --stack-trace-limit=200 ./prox.js $@ >>$PROXLOG 2>>$ERRLOG &

sleep 5
cat $PROXLOG
echo
