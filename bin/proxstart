#!/bin/bash

# Production proxibase startup script using nodemon
# See https://github.com/remy/nodemon

PROX='/usr/local/prox'
PROXLOG='/var/log/prox/prox.log'
ERRLOG='/var/log/prox/proxerr.log'

# Replace the existing log, must be the first argument
if [ "$1" = "-r" ]; then
  rm $PROXLOG
  rm $ERRLOG
  shift
fi

echo "proxerr.log: $ERRLOG"
echo "prox.log: $PROXLOG ..."

cd $PROX
nohup nodemon -L --watch ./lib --delay 2 --stack-trace-limit=200 ./prox.js $@ >>$PROXLOG 2>>$ERRLOG &

sleep 5
cat $PROXLOG
echo
