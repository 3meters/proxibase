#!/bin/sh

# production proxibase startup script using nodemon
# see https://github.com/remy/nodemon
# Useage:
#   sudo $PROX/bin/proxstart

if [ ! $PROX ]; then
  PROX='/usr/local/prox'
fi

if [ ! $PROXLOG ]; then
  PROXLOG='/var/log/prox/prox.log'
fi

# clean the existing log
if [ "$1" = "-c" ]; then
  rm $PROXLOG
fi

echo "proxlog: $PROXLOG ..."

cd $PROX
nohup nodemon --watch ./lib --delay 1 ./prox.js >>$PROXLOG 2>&1 &

# TODO: we should capture the process ID and stash so we can kill it specifically later

sleep 5
cat $PROXLOG
echo
